# NYC应急管控研究项目 - 环境配置文档

## 1. 项目概述

本项目是一个关于纽约市(NYC)应急管控能力的综合研究系统，通过多阶段分析对城市建筑变化、通信设施密度、建筑需求等进行建模和可视化。系统采用Python进行数据处理、分析和可视化，使用多种地理空间分析库和交互式仪表盘技术展示研究结果。

主要功能模块：
- 建筑变化分析与数据预处理
- 城市更新指数计算
- 通信设施密度(ECI)分析
- 建筑需求因子建模
- 应急管控能力指数(EMCI)预测
- 社区应急特征聚类分析
- 交互式数据可视化仪表盘

## 2. 项目结构

```
d:\code\1\
├── Phase1\                # 阶段一：建筑变化分析
│   ├── clean_mappluto_all_years_geo.py
│   ├── clean_pluto_all_years.py
│   ├── merge.py
│   ├── pluto_change_detection.py
│   └── pluto_map_time_slider.py
├── Phase2\                # 阶段二：更新指数计算
│   └── pluto_update_index.py
├── Phase3\                # 阶段三：通信设施分析
│   ├── clean.py
│   ├── eci_d.py
│   └── eci_time.py
├── Phase4\                # 阶段四：需求指数建模
│   ├── D_time.py
│   └── calc_building_demand.py
├── Phase5\                # 阶段五：EMCI指数计算与预测
│   └── forecast.py
├── Phase6\                # 阶段六：聚类分析
│   └── julei.py
├── nyc_dashboard.py       # 主仪表盘应用
└── requirements.md        # Python依赖包列表
```

## 3. 环境要求

### 3.1 软件环境要求

- **Python 版本**: 3.8 或更高
- **主要依赖包**:
  - pandas==2.0.3
  - numpy==1.24.3
  - matplotlib==3.7.2
  - seaborn==0.12.2
  - scikit-learn==1.3.0
  - dash==2.14.0
  - dash-bootstrap-components==1.4.2
  - geopandas==0.13.2
  - shapely==2.0.1
  - scipy==1.10.1
  - folium==0.15.1
  - branca==0.7.0
  - pyproj==3.6.1
  - fiona==1.9.4.post1

### 3.2 系统要求

- **操作系统**: Windows 10/11、macOS 10.15+、Linux
- **内存**: 建议8GB以上
- **存储**: 至少10GB可用空间（用于数据和临时文件）

## 4. 环境配置步骤

### 4.1 安装Python

如果尚未安装Python，请从[Python官网](https://www.python.org/downloads/)下载并安装Python 3.8或更高版本。安装时请勾选"Add Python to PATH"选项。

### 4.2 创建虚拟环境（推荐）

```bash
# Windows系统
python -m venv venv
venv\Scripts\activate

# Linux/Mac系统
python3 -m venv venv
source venv/bin/activate
```

### 4.3 安装依赖包

进入项目目录，执行以下命令安装所有依赖：

```bash
cd d:\code\1
pip install -r requirements.md
```

## 5. 数据准备

### 5.1 数据文件位置

项目使用以下主要数据文件（需要用户自行准备或调整路径）：

- PLUTO地块数据（GeoJSON或Shapefile格式）
- NTA社区边界数据（Shapefile格式）
- LinkNYC通信设施数据（GeoJSON格式）

### 5.2 路径配置

注意：项目中的大部分脚本都包含硬编码的文件路径，需要根据实际情况修改。主要需要修改的路径变量包括：

- `BASE_PATH` (在nyc_dashboard.py中)
- `BASE_DIR` 或 `BASE` (在各阶段脚本中)
- 输入输出文件路径（在各阶段脚本中）

## 6. 项目使用说明

### 6.1 按阶段运行分析

项目设计为按阶段顺序运行，每个阶段的输出作为下一阶段的输入：

1. **阶段一**：建筑变化分析
   ```bash
   cd d:\code\1\Phase1
   python merge.py
   python clean_pluto_all_years.py
   python pluto_change_detection.py
   ```

2. **阶段二**：更新指数计算
   ```bash
   cd d:\code\1\Phase2
   python pluto_update_index.py
   ```

3. **阶段三**：通信设施分析
   ```bash
   cd d:\code\1\Phase3
   python clean.py
   python eci_d.py
   ```

4. **阶段四**：需求指数建模
   ```bash
   cd d:\code\1\Phase4
   python D_time.py
   ```

5. **阶段五**：EMCI指数计算与预测
   ```bash
   cd d:\code\1\Phase5
   python forecast.py
   ```

6. **阶段六**：聚类分析
   ```bash
   cd d:\code\1\Phase6
   python julei.py
   ```

### 6.2 运行仪表盘

完成各阶段分析后，可以启动交互式仪表盘查看结果：

```bash
cd d:\code\1
python nyc_dashboard.py
```

启动后，在浏览器中访问 http://localhost:8050 查看仪表盘。

## 7. 常见问题与解决方案

### 7.1 Python环境问题

- **问题**: 安装geopandas时出现错误
  **解决方案**: 推荐使用conda安装地理空间包：
  ```bash
  conda install -c conda-forge geopandas fiona pyproj
  ```

- **问题**: 缺少Microsoft Visual C++ 14.0或更高版本
  **解决方案**: 下载并安装[Microsoft Visual C++ Build Tools](https://visualstudio.microsoft.com/visual-cpp-build-tools/)

### 7.2 数据路径问题

- **问题**: 找不到指定的文件或目录
  **解决方案**: 检查并修改脚本中的文件路径变量，确保与实际文件位置一致

### 7.3 内存不足错误

- **问题**: 处理大型GeoJSON或Shapefile时内存不足
  **解决方案**: 分批处理数据或增加系统虚拟内存

## 8. 硬件要求

- **推荐配置**:
  - CPU: Intel Core i5或更高
  - 内存: 16GB或更高（处理大型地理空间数据）
  - 存储: SSD存储，20GB可用空间

## 9. 注意事项

- 项目中的文件路径默认使用Windows格式，在Linux/Mac系统上运行时需要修改为对应的路径格式
- 地理空间数据处理可能需要较多的内存资源
- 运行仪表盘前，请确保已完成各阶段分析并生成所需的输出文件

## 10. 扩展与维护

如需扩展或维护项目，建议：
- 添加新分析功能时，按照现有的阶段结构组织代码
- 新增依赖包后，更新requirements.md文件
- 定期检查并更新依赖包版本

---

文档创建日期: 2024-01-15